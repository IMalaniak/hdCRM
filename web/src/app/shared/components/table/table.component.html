<ng-container *ngIf="columns">
  <!-- TABLE -->
  <div class="table-container" [class.no-outline-border]="!hasOutlineBorder">
    <atoms-icon-button
      *ngIf="hasSettings"
      class="table-config"
      [color]="themePalette.BASIC"
      [matType]="matButtonType.ICON"
      [type]="buttonType.BUTTON"
      [icon]="icons.gear"
      [matMenuTriggerFor]="menu"
    >
    </atoms-icon-button>
    <table mat-table #table matSort [dataSource]="dataSource" [trackBy]="trackById">
      <!-- COLUMNS & ROWS-->
      <ng-container
        *ngFor="let column of columns"
        [matColumnDef]="column.key"
        [sticky]="column.sticky"
        [stickyEnd]="column.stickyEnd"
      >
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          [ngClass]="[
            getColumnClasses(column.horizontalAlign, column.customClass),
            getActionsStickyBorders(column.key)
          ]"
          [disabled]="!canSort || !column.hasSorting"
        >
          <ng-container *ngIf="column.key !== columnActionsKey">
            {{ column.label }}
          </ng-container>
        </th>
        <td
          mat-cell
          *matCellDef="let row; let i = index"
          [ngClass]="[
            getColumnClasses(column.horizontalAlign, row[column.key].customClass),
            getActionsStickyBorders(column.key)
          ]"
        >
          <!-- CELL SWITCH CASES -->
          <ng-container [ngSwitch]="row[column.key].cellType">
            <!-- Sequence number -->
            <ng-container *ngSwitchCase="cellType.Sequence">
              {{ i | memoize: getSequenceNumber:this }}
            </ng-container>

            <!-- String -->
            <ng-container *ngSwitchCase="cellType.String" [ngClass]="row[column.key].customClass">
              {{ row[column.key].value }}
            </ng-container>

            <!-- Navigation -->
            <ng-container *ngSwitchCase="cellType.Navigation">
              <atoms-link-button
                linkClass="w-100 text-underline text-left"
                [linkLabel]="row[column.key].value"
                [linkColor]="themePalette.BASIC"
                [linkType]="row[column.key].navigation.linkType"
                [linkHref]="row[column.key].navigation.linkHref"
                [target]="row[column.key].navigation.target"
                (click)="$event.stopPropagation()"
              ></atoms-link-button>
            </ng-container>

            <!-- Checkbox -->
            <!-- // TODO: in separate task make checkbox to work -->
            <!-- <ng-container *ngSwitchCase="cellType.Checkbox">
              <mat-checkbox
                [checked]="row[column.key].value"
                [disabled]="row[column.key].disabled"
                (change)="actionClicked(row[column.key].cellAction, i, $event)"
              ></mat-checkbox>
            </ng-container> -->

            <!-- Icon -->
            <ng-container *ngSwitchCase="cellType.Icon">
              <mat-icon
                [color]="row[column.key].customClass"
                [svgIcon]="row[column.key].value ? icons.checkCircle : icons.xCircle"
              ></mat-icon>
            </ng-container>

            <!-- Avatar -->
            <ng-container *ngSwitchCase="cellType.Avatar">
              <atoms-user-pic
                [avatar]="row[column.key].value?.avatar"
                [userOnline]="row[column.key].value?.online"
              ></atoms-user-pic>
            </ng-container>

            <!-- Date -->
            <ng-container *ngSwitchCase="cellType.Date">
              {{ row[column.key].value | dateTimeFormat | async }}
            </ng-container>

            <!-- Actions-->
            <ng-container *ngSwitchCase="cellType.Actions">
              <ng-container *ngIf="rowActions">
                <atoms-icon-button
                  [color]="themePalette.BASIC"
                  [matType]="matButtonType.ICON"
                  [type]="buttonType.BUTTON"
                  [icon]="icons.threeDots"
                  [matMenuTriggerFor]="actionsMenu"
                  (click)="$event.stopPropagation()"
                >
                </atoms-icon-button>

                <mat-menu #actionsMenu="matMenu">
                  <ng-template matMenuContent>
                    <ng-container *ngFor="let action of rowActions">
                      <button
                        *ngIf="action.data.actionType | memoize: getRowActionVisibility:this"
                        mat-menu-item
                        (click)="rowDedicatedAction(row.id, action.data)"
                      >
                        <mat-icon
                          [svgIcon]="action.icon"
                          [color]="action.data.actionType | memoize: getRowActionIconColor:this"
                        >
                        </mat-icon>
                        <span>{{ action.label }}</span>
                      </button>
                    </ng-container>
                  </ng-template>
                </mat-menu>
              </ng-container>
            </ng-container>
          </ng-container>
        </td>
      </ng-container>

      <!-- ROWS -->
      <tr mat-header-row *matHeaderRowDef="columnsToDisplay$ | async; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: columnsToDisplay$ | async" (click)="rowSelect(row.id)"></tr>
      <tr *matNoDataRow>
        <td [attr.colspan]="(columnsToDisplay$ | async)?.length">
          <atoms-no-content-info [noContentMessage]="noContentMessage"></atoms-no-content-info>
        </td>
      </tr>
    </table>
  </div>

  <!-- PAGINATOR -->
  <mat-paginator
    showFirstLastButtons
    [length]="totalItems"
    [pageSize]="itemsPerPageState$ | async"
    [pageSizeOptions]="pageSizeOptions"
  ></mat-paginator>

  <!-- MENU -->
  <mat-menu #menu="matMenu">
    <ng-template matMenuContent>
      <!-- configure columns -->
      <button mat-menu-item [matMenuTriggerFor]="tableColumns">
        <mat-icon [svgIcon]="icons.checksGrid"> </mat-icon>
        <span>Configure columns</span>
      </button>
      <!-- reset grid -->
      <button mat-menu-item (click)="resetTableConfig()">
        <mat-icon [svgIcon]="icons.arrowClock"> </mat-icon>
        <span>Reset grid</span>
      </button>
    </ng-template>
  </mat-menu>

  <!-- MENU COLUMNS-->
  <mat-menu #tableColumns="matMenu">
    <ng-template matMenuContent>
      <div
        class="column-config-wrapper"
        cdkDropList
        (cdkDropListDropped)="dropColumns($event)"
        [cdkDropListSortPredicate]="dropColumnsPredicate"
        [cdkDropListData]="columns"
      >
        <div
          *ngFor="let column of columns"
          cdkDragBoundary=".column-config-wrapper"
          cdkDragLockAxis="y"
          [cdkDragDisabled]="!column.draggable"
          cdkDrag
          [cdkDragData]="column"
        >
          <span *ngIf="column.hidable" mat-menu-item class="d-flex justify-content-between align-items-center">
            <mat-checkbox
              (click)="$event.stopPropagation()"
              (change)="updateTableConfig()"
              [(ngModel)]="column.isVisible"
            >
              <span class="ml-1 text-capitalize"> {{ column.label }} </span>
            </mat-checkbox>
            <span class="drag-handler" cdkDragHandle>
              <mat-icon *ngIf="column.draggable" [svgIcon]="icons.columnDrag"> </mat-icon>
            </span>
          </span>
        </div>
      </div>
    </ng-template>
  </mat-menu>
</ng-container>
