<!--
<section class="app-content-box" [title]="'Search'" [cssClass]="'search-advanced'" i18n="@@usersComponentHeaderSearch">

</section>
-->
<section class="app-content-box" [title]="'User list'" [showDataLoader]="loading$ | async">
  <div buttons>
    <button mat-raised-button color="primary" class="crm-button" *ngIf="addUserPrivilege$ | async" routerLink="/auth/register"><mat-icon>person_add</mat-icon><span i18n="@@usersComponentActionsRegisterANewUser">Register a new user</span></button>
  </div>
  <section subheader *ngIf="selection.selected.length > 0" class="bg-primary text-white p-2 fixed-bottom">
    <span class="w-100" i18n="@@usersComponentBulkSectionSelectedUsers">Selected users: {{ selection.selected.length }}</span>
    <section class="d-flex align-items-center">
      <span i18n="@@usersComponentBulkSectionWithSelectedUsers">Actions with selected: </span>
      <button mat-icon-button (click)="changeStateOfSelected('active')" title="'Activate'" i18n-title="@@usersComponentBulkSectionActionsActivate">
        <mat-icon>launch</mat-icon>
      </button>
      <button mat-icon-button (click)="changeStateOfSelected('disabled')" title="'Deactivate'" i18n-title="@@usersComponentBulkSectionActionsDeactivate">
        <mat-icon>block</mat-icon>
      </button>
      <button mat-icon-button (click)="changeStateOfSelected('archive')" title="'Archive'" i18n-title="@@usersComponentBulkSectionActionsArchive">
        <mat-icon>archive</mat-icon>
      </button>
    </section>
  </section>

  <div content class="mat-elevation-z8 users-table-container">
    <mat-table content class="users-table crm-table" [dataSource]="dataSource" matSort matSortDisabled>
        <ng-container matColumnDef="select" sticky>
          <mat-header-cell *matHeaderCellDef>
            <!-- <mat-checkbox (change)="$event ? masterToggle() : null"
                          [checked]="selection.hasValue() && isAllSelected()"
                          [indeterminate]="selection.hasValue() && !isAllSelected()">
            </mat-checkbox> -->
          </mat-header-cell>
          <mat-cell *matCellDef="let row">
            <mat-checkbox (click)="$event.stopPropagation()"
                          (change)="$event ? selection.toggle(row) : null"
                          [checked]="selection.isSelected(row)">
            </mat-checkbox>
          </mat-cell>
        </ng-container>
        <ng-container matColumnDef="avatar">
          <mat-header-cell *matHeaderCellDef></mat-header-cell>
          <mat-cell *matCellDef="let user">
            <img class="userpic" *ngIf="user.avatar" src="{{user.avatar.getThumbnailsUrl}}" alt="{{user.avatar.title}}">
            <img class="userpic" *ngIf="!user.avatar" src="./assets/images/userpic/noimage_croped.png" alt="noimage">
          </mat-cell>
        </ng-container>
        <ng-container matColumnDef="login">
          <mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@usersComponentListLogin">Login</mat-header-cell>
          <mat-cell *matCellDef="let user">{{ user.login }}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="email">
          <mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@usersComponentListEmail">Email</mat-header-cell>
          <mat-cell *matCellDef="let user">{{ user.email }}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="name">
          <mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@usersComponentListName">Name</mat-header-cell>
          <mat-cell *matCellDef="let user">{{ user.name }}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="surname">
          <mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@usersComponentListSurname">Surname</mat-header-cell>
          <mat-cell *matCellDef="let user">{{ user.surname }}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="phone">
          <mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@usersComponentListPhone">Phone</mat-header-cell>
          <mat-cell *matCellDef="let user">{{ user.phone }}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="dep">
          <mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@usersComponentListDepartment">Department</mat-header-cell>
          <mat-cell *matCellDef="let user">{{ user.Department ? user.Department.title  : '-' }}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="state">
          <mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@usersComponentListState">State</mat-header-cell>
          <mat-cell *matCellDef="let user">{{ user.State.keyString }}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="createdAt">
          <mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@usersComponentListCreatedAt">Date created</mat-header-cell>
          <mat-cell *matCellDef="let user">{{ user.createdAt | date: 'short' }}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="updatedAt">
          <mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@usersComponentListUpdatedAt">Date updated</mat-header-cell>
          <mat-cell *matCellDef="let user">{{ user.updatedAt | date: 'short' }}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="actions" stickyEnd>
          <mat-header-cell *matHeaderCellDef></mat-header-cell>
          <mat-cell *matCellDef="let user">
            <button mat-icon-button [matMenuTriggerFor]="menu">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="onUserSelect(user.id)">
                <mat-icon>details</mat-icon>
                <span i18n="@@usersComponentListActionsView">Details</span>
              </button>
              <button *ngIf="editUserPrivilege$ | async" mat-menu-item (click)="onUserSelect(user.id, true)">
                <mat-icon>edit</mat-icon>
                <span i18n="@@usersComponentListActionsEdit">Edit</span>
              </button>
              <button *ngIf="(editUserPrivilege$ | async) && user.State.id === 2" mat-menu-item (click)="this.changeUserState(user, 3)">
                <mat-icon>block</mat-icon>
                <span i18n="@@usersComponentListActionsDeactivate">Deactivate user</span>
              </button>
              <button *ngIf="(editUserPrivilege$ | async) && (user.State.id === 1 || user.State.id === 3)" mat-menu-item (click)="this.changeUserState(user, 2)">
                <mat-icon>launch</mat-icon>
                <span i18n="@@usersComponentListActionsActivate">Activate user</span>
              </button>
              <button *ngIf="editUserPrivilege$ | async" mat-menu-item (click)="this.changeUserState(user, 4)">
                <mat-icon>archive</mat-icon>
                <span i18n="@@usersComponentListActionsArchive">Archive user</span>
              </button>
            </mat-menu>
          </mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
    </mat-table>

    <mat-paginator [length]="resultsLength$ | async" [pageSizeOptions]="[5, 10, 15]" showFirstLastButtons></mat-paginator>
  </div>

</section>
