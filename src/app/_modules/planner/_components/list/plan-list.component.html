<!--
<section class="app-content-box" [title]="'PLANNER.Search.header'" [cssClass]="'search-advanced'">

</section>
-->
<section class="app-content-box" [title]="'Plan list'" [showDataLoader]="loading$ | async">

  <div buttons *ngIf="addPlanPrivilege$ | async">
    <button mat-raised-button color="primary" class="crm-button" routerLink="/planner/add"><mat-icon>add_circle</mat-icon><span i18n="@@plannerСomponentActionCreateNewPlan">Create a new plan</span></button>
  </div>

  <div content class="table-container">
    <mat-table class="plans-table crm-table" [dataSource]="dataSource" matSort matSortDisabled>
        <!-- Checkbox Column -->
        <!-- <ng-container matColumnDef="select">
          <mat-header-cell *matHeaderCellDef>
            <mat-checkbox (change)="$event ? masterToggle() : null"
                          [checked]="selection.hasValue() && isAllSelected()"
                          [indeterminate]="selection.hasValue() && !isAllSelected()"
                          [aria-label]="checkboxLabel()">
            </mat-checkbox>
          </mat-header-cell>
          <mat-cell *matCellDef="let row">
            <mat-checkbox (click)="$event.stopPropagation()"
                          (change)="$event ? selection.toggle(row) : null"
                          [checked]="selection.isSelected(row)"
                          [aria-label]="checkboxLabel(row)">
            </mat-checkbox>
          </mat-cell>
        </ng-container> -->
        <ng-container matColumnDef="title">
          <mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@plannerСomponentListTitle">Title</mat-header-cell>
          <mat-cell *matCellDef="let plan">{{plan.title}}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="creator">
          <mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@plannerСomponentListCreator">Creator</mat-header-cell>
          <mat-cell *matCellDef="let plan">{{plan.Creator.name + ' ' + plan.Creator.surname}}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="stage">
          <mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@plannerСomponentListStage">Stage</mat-header-cell>
          <mat-cell *matCellDef="let plan">{{plan.activeStage.keyString}}</mat-cell>
        </ng-container>        
        <ng-container matColumnDef="participants">
          <mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@plannerСomponentListParticipants">Participants</mat-header-cell>
          <mat-cell *matCellDef="let plan">{{plan.Participants.length}}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="createdAt">
          <mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@plannerComponentListCreatedAt">Created At</mat-header-cell>
          <mat-cell *matCellDef="let plan">{{plan.createdAt | date: 'short'}}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="updatedAt">
          <mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@plannerComponentListUpdatedAt">Updated At</mat-header-cell>
          <mat-cell *matCellDef="let plan">{{plan.updatedAt | date: 'short'}}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="deadline">
          <mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@plannerComponentListDeadLine">Deadline</mat-header-cell>
          <mat-cell *matCellDef="let plan">{{plan.deadline | date: 'short'}}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="actions" stickyEnd >
          <mat-header-cell *matHeaderCellDef i18n="@@globalsListActions"></mat-header-cell>
          <mat-cell *matCellDef="let plan">
              <button mat-icon-button [matMenuTriggerFor]="menu">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="onPlanSelect(plan.id)">
                  <mat-icon>details</mat-icon>
                  <span i18n="@@plannerComponentListActionsView">Details</span>
                </button>
                <button *ngIf="editPlanPrivilege$ | async" mat-menu-item (click)="onPlanSelect(plan.id, true)">
                  <mat-icon>edit</mat-icon>
                  <span i18n="@@plannerComponentListActionsEdit">Edit</span>
                </button>
              </mat-menu>
          </mat-cell>
        </ng-container>
        <mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
    </mat-table>
  </div>
  <mat-paginator content [length]="resultsLength$ | async" [pageSizeOptions]="[5, 10, 15]" showFirstLastButtons></mat-paginator>
</section>
