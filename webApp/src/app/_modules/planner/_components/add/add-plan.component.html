<section
  class="app-content-box"
  [title]="'Create a new plan'"
  [cssClass]="'bg-secondary border-0'"
  [contentCssClass]="'bg-light'"
  [headCssClass]="'text-white'"
>
  <div content class="row">
    <div class="col-md-8">
      <form [formGroup]="planData">
        <div class="d-flex flex-column">
          <mat-form-field appearance="outline">
            <mat-label i18n="@@registerPlanComponentDetailsTitle">Title</mat-label>
            <input matInput formControlName="title" type="text" required />
            <mat-error
              *ngIf="
                planData.controls['title'].invalid &&
                (planData.controls['title'].dirty || planData.controls['title'].touched)
              "
            >
              <mat-error
                *ngIf="planData.controls['title'].errors.required"
                i18n="@@addPlanComponentInputTitleErrorsRequired"
              >
                Title is required!
              </mat-error>
              <mat-error
                *ngIf="planData.controls['title'].errors.maxlength"
                i18n="@@addPlanComponentInputTitleErrorsMaxlenth"
              >
                Title is too long!
              </mat-error>
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label i18n="@@registerPlanComponentDetailsBudget">Budget</mat-label>
            <input matInput formControlName="budget" type="number" step="0.01" required />
            <mat-error
              *ngIf="
                planData.controls['budget'].invalid &&
                (planData.controls['budget'].dirty || planData.controls['budget'].touched)
              "
            >
              <mat-error
                *ngIf="planData.controls['budget'].errors.required"
                i18n="@@addPlanComponentInputBudgetErrorsRequired"
              >
                Budget is required!
              </mat-error>
              <mat-error *ngIf="planData.controls['budget'].errors.min" i18n="@@addPlanComponentInputBudgetErrorsMin">
                Budget is invalid!
              </mat-error>
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label i18n="@@registerPlanComponentDetailsDescription">Write a description</mat-label>
            <textarea matInput formControlName="description" type="text" required></textarea>
            <mat-error
              *ngIf="
                planData.controls['description'].invalid &&
                (planData.controls['description'].dirty || planData.controls['description'].touched)
              "
            >
              <mat-error
                *ngIf="planData.controls['description'].errors.required"
                i18n="@@addPlanComponentInputDescriptionErrorsRequired"
              >
                Description is required!
              </mat-error>
              <mat-error
                *ngIf="planData.controls['description'].errors.maxlength"
                i18n="@@addPlanComponentInputDescriptionErrorsMaxlength"
              >
                Description is too long!
              </mat-error>
            </mat-error>
          </mat-form-field>
          <mat-form-field color="primary" appearance="outline">
            <mat-label i18n="@@registerPlanComponentDetailsDeadline">Deadline</mat-label>
            <input
              matInput
              [min]="plan.createdAt"
              [matDatepicker]="picker"
              formControlName="deadline"
              type="datetime"
              required
            />
            <mat-error
              *ngIf="
                planData.controls['deadline'].invalid &&
                (planData.controls['deadline'].dirty || planData.controls['deadline'].touched)
              "
            >
              <mat-error
                *ngIf="planData.controls['deadline'].errors.required"
                i18n="@@addPlanComponentInputDeadlineErrorsRequired"
              >
                Deadline is required!
              </mat-error>
            </mat-error>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker touchUi #picker></mat-datepicker>
          </mat-form-field>
        </div>
      </form>
    </div>
    <div class="col-md-4">
      <section
        class="app-content-box"
        [title]="'Participants'"
        [cssClass]="'border border-secondary mt-3 mt-md-0 mb-0'"
        [contentCssClass]="'p-0'"
        [disableShadow]="true"
        [counter]="plan.Participants.length"
      >
        <button buttons mat-stroked-button color="primary" class="crm-button" (click)="addParticipantDialog()">
          <fa-icon [icon]="['fas', 'user-plus']"></fa-icon
          ><span i18n="@@addDepartmentComponentActionsAddParticipants">Add participants</span>
        </button>
        <mat-list content>
          <mat-list-item *ngFor="let user of plan.Participants; let i = index">
            <img
              matListAvatar
              *ngIf="user.avatar"
              src="{{ user.avatar.getThumbnailsUrl }}"
              alt="{{ user.avatar.title }}"
            />
            <img matListAvatar *ngIf="!user.avatar" src="./assets/images/userpic/noimage_croped.png" alt="noimage" />
            <h3 matLine>{{ user.fullname }}</h3>
            <mat-divider></mat-divider>
          </mat-list-item>
        </mat-list>
      </section>
    </div>
  </div>
  <button
    buttons
    mat-raised-button
    color="primary"
    class="crm-button"
    (click)="onClickSubmit()"
    [disabled]="planData.invalid"
  >
    <fa-icon [icon]="['fas', 'paper-plane']"></fa-icon><span i18n="@@registerPlanComponentActionSubmit">Submit</span>
  </button>
</section>

<app-attachments *ngIf="plan" [attachments]="plan.Documents" [editForm]="true"></app-attachments>
